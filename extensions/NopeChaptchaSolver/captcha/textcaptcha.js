(()=>{var l=chrome;function b(e){let t=("fff12fa3cdd64ff83a30d7b392be57e978a86eee93b9728ed0366bf231abdaad"+e).split("").map(n=>n.charCodeAt(0));return y(t)}var v=new Uint32Array(256);for(let e=256;e--;){let t=e;for(let n=8;n--;)t=t&1?3988292384^t>>>1:t>>>1;v[e]=t}function y(e){let t=-1;for(let n of e)t=t>>>8^v[t&255^n];return(t^-1)>>>0}async function a(e,t){let n=""+[+new Date,performance.now(),Math.random()],[o,r]=await new Promise(s=>{l.runtime.sendMessage([n,e,...t],s)});if(o===b(n))return r}function C(){let e;return t=>e||(e=t().finally(()=>e=void 0),e)}var P=C(),i;function S(){return P(async()=>(i||(i=await a("settings::get",[])),i))}function x(e){i&&(i={...i,...e},M(i))}function f(){return i}var w=[];function k(e,t,n){let o=[e,t,n];w.push(o),T(o,f())}function T(e,t){let n=e[1](t),o=!!e[3];n!==o&&(n?e[3]=e[2]():(e[3](),e[3]=null))}function M(e){w.forEach(t=>T(t,e))}function H(){l.runtime.connect({name:"stream"}).onMessage.addListener(t=>{t.event==="settingsUpdate"&&x(t.settings)})}function m(e){if(document.readyState!=="loading")setTimeout(e,0);else{let t;t=()=>{removeEventListener("DOMContentLoaded",t),e()},addEventListener("DOMContentLoaded",t)}}function B(e){return e.toDataURL("image/jpeg").replace(/data:image\/[a-z]+;base64,/g,"")}function D(e){try{e.getContext("2d").getImageData(0,0,1,1)}catch{return!0}return!1}async function p(e,t){!t&&!e.complete&&await new Promise(r=>e.addEventListener("load",r));let n=document.createElement("canvas");return n.width=e.naturalWidth||t?.clientWidth,n.height=e.naturalHeight||t?.clientHeight,n.getContext("2d").drawImage(e,0,0),!D(n)&&n}async function E(e){let n=getComputedStyle(e).backgroundImage;if(!n||n==="none")if("src"in e&&e.src)n=`url("${e.src}")`;else return;if("computedStyleMap"in e){let u=e.computedStyleMap().get("background-image");if(u instanceof CSSImageValue){let g=await p(u,e);if(g)return g}}let o=/"(.+)"/.exec(n);if(!o)return;n=o[1];let r=document.createElement("a");if(r.href=n,new URL(r.href).origin===document.location.origin){let u=new Image;u.crossOrigin="anonymous",u.src=n;let g=await p(u);if(g)return g}let s=await a("fetch::asData",[n,{}]),c=new Image;c.crossOrigin="anonymous",c.src=s.data;let d=await p(c);return d}function _(e){return new Promise(t=>setTimeout(t,e))}async function L(e,t){let n={v:l.runtime.getManifest().version,key:N(e)},o=await a("tab::getURL",[]);return o&&(t||!e.key||new URL(o).hostname.endsWith("nopecha.com"))&&(n.url=o),n}function N(e){return!e.keys||!e.keys.length?e.key:e.keys[Math.floor(Math.random()*e.keys.length)]}var h=!1;function I(){let e=!1,t=new MutationObserver(async()=>{e||h||(e=!0,await _(1e3),e=!1,A())});return t.observe(document,{subtree:!0,childList:!0,attributes:!0}),A(),()=>t.disconnect()}async function A(){let e=f(),t=document.querySelector(e.textcaptcha_image_selector),n=document.querySelector(e.textcaptcha_input_selector);if(!t||!n||n.value)return;await a("tab::registerDetectedCaptcha",["textcaptcha"]),h=!0;let o;try{if(o=await U(t,e),!o)return;n.value=o}finally{h=!1}}async function R(e){if(e instanceof HTMLCanvasElement)return e;if(e instanceof HTMLImageElement&&(e.src||e.srcset)){let t=await p(e);if(t)return t}return await E(e)}async function U(e,t){let n=await R(e);if(!n)return;let o=B(n),r=new Date().valueOf(),s=await a("api::recognition",[{type:"textcaptcha",image_data:[o],...await L(t)}]);if("error"in s){console.warn("[@nope/textcaptcha] api error",s);return}let c=new Date().valueOf();if(t.textcaptcha_solve_delay){let d=t.textcaptcha_solve_delay_time-c+r;d>0&&await _(d)}return s.data[0]}async function q(){H(),await S();let e=location.hostname;k("textcaptcha/auto-solve",t=>t.enabled&&t.textcaptcha_auto_solve&&t.textcaptcha_image_selector&&t.textcaptcha_input_selector&&!t.disabled_hosts.includes(e),I)}m(q);})();
